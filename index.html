<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BIO-BREACH HUB</title>
    <style>
        :root { --gold: #ffd700; --bg: #0a0a0a; --card: #161616; --blue: #0078d4; --green: #00ff41; --orange: #ff8c00; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding: 0; user-select: none; }
        .header { background: #000; padding: 20px; text-align: center; border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 10; }
        .header h1 { margin: 0; font-size: 1.4rem; color: var(--gold); text-transform: uppercase; letter-spacing: 2px; }
        #status-bar { font-size: 0.65rem; color: var(--orange); text-transform: uppercase; margin-top: 5px; }
        .container { padding: 15px; padding-bottom: 100px; }
        .project-card { background: var(--card); border-radius: 12px; padding: 20px; margin-bottom: 15px; border: 1px solid #333; display: flex; flex-direction: column; gap: 12px; }
        .v-name { font-size: 1.1rem; font-weight: bold; color: #fff; }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: #444; display: inline-block; margin-right: 5px; }
        .dot.active { background: var(--green); box-shadow: 0 0 8px var(--green); }
        .btn { border: none; padding: 15px; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer; text-align: center; color: white; text-decoration: none; }
        .btn-play { background: var(--green); }
        .btn-download { background: var(--blue); }
        #game-view { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1000; }
        iframe { width: 100%; height: 100%; border: none; }
        #btn-cerrar { position: fixed; bottom: 20px; right: 20px; background: red; color: white; border: none; padding: 12px 24px; border-radius: 50px; z-index: 2000; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <h1>BIO-BREACH HUB</h1>
        <div id="status-bar">CONECTANDO...</div>
    </div>

    <div class="container" id="lista-versiones">
        <p style="text-align:center; color:#666;">Cargando base de datos...</p>
    </div>

    <div id="game-view">
        <iframe id="game-frame"></iframe>
    </div>
    
    <button id="btn-cerrar" style="display:none;" onclick="cerrarMotor()">CERRAR MOTOR</button>

    <script>
        const URL_REPO = "https://elfaraon65.github.io/bio-breach-repositorio/versiones.json"; 

        window.onload = () => {
            actualizarInterfaz();
        };

        function getLocales() {
            return JSON.parse(localStorage.getItem('bio_breach_v_data')) || {};
        }

        async function actualizarInterfaz() {
            const lista = document.getElementById('lista-versiones');
            const status = document.getElementById('status-bar');
            const locales = getLocales();
            
            try {
                // Buscamos la lista de versiones en tu GitHub
                const res = await fetch(URL_REPO + "?t=" + Date.now());
                const nube = await res.json();
                status.innerText = "SISTEMA EN LÍNEA";
                status.style.color = "var(--green)";
                
                lista.innerHTML = "";
                nube.forEach(item => {
                    const estaDescargado = locales[item.id];
                    const card = document.createElement('div');
                    card.className = 'project-card';
                    card.innerHTML = `
                        <div class="v-name">${item.nombre}</div>
                        <div style="font-size:0.8rem; color:#888;">
                            <div class="dot ${estaDescargado ? 'active' : ''}"></div> 
                            ${estaDescargado ? 'INSTALADO' : 'DISPONIBLE EN NUBE'}
                        </div>
                        <button class="btn ${estaDescargado ? 'btn-play' : 'btn-download'}" 
                                onclick="${estaDescargado ? `lanzarMotor('${item.id}')` : `descargar('${item.url}','${item.id}','${item.nombre}')`}">
                            ${estaDescargado ? 'INICIAR' : 'DESCARGAR'}
                        </button>
                    `;
                    lista.appendChild(card);
                });
            } catch (e) {
                status.innerText = "MODO OFFLINE (SÓLO LOCAL)";
                status.style.color = "var(--orange)";
                // Si no hay internet, mostramos lo que ya está en memoria
                renderSoloLocales();
            }
        }

        function renderSoloLocales() {
            const lista = document.getElementById('lista-versiones');
            const locales = getLocales();
            lista.innerHTML = "";
            Object.keys(locales).forEach(id => {
                const v = locales[id];
                const card = document.createElement('div');
                card.className = 'project-card';
                card.innerHTML = `
                    <div class="v-name">${v.nombre}</div>
                    <button class="btn btn-play" onclick="lanzarMotor('${id}')">INICIAR (OFFLINE)</button>
                `;
                lista.appendChild(card);
            });
        }

        async function descargar(url, id, nombre) {
            alert("Iniciando descarga de " + nombre);
            try {
                const res = await fetch(url);
                const codigo = await res.text();
                let locales = getLocales();
                locales[id] = { nombre, codigo };
                localStorage.setItem('bio_breach_v_data', JSON.stringify(locales));
                actualizarInterfaz();
            } catch (e) { alert("Error de conexión"); }
        }

        function lanzarMotor(id) {
            const locales = getLocales();
            document.getElementById('game-view').style.display = "block";
            document.getElementById('btn-cerrar').style.display = "block";
            const blob = new Blob([locales[id].codigo], { type: 'text/html' });
            document.getElementById('game-frame').src = URL.createObjectURL(blob);
        }

        function cerrarMotor() {
            document.getElementById('game-view').style.display = "none";
            document.getElementById('btn-cerrar').style.display = "none";
            document.getElementById('game-frame').src = "about:blank";
        }
    </script>
</body>
</html>
